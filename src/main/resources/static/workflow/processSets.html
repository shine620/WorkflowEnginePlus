<!DOCTYPE html>
<html>
	<head>

		<meta charset="utf-8">
		<title></title>
		<link href="../component/layui/css/layui.css" rel="stylesheet" />
		<link href="../admin/css/pearCommon.css" rel="stylesheet" />

		<style>
			.layui-table-view {
				border: 1px solid #e6e6e6 !important;
			}
			.layui-table-header, .layui-table-header th {
				background-color: #FDFCF9 !important;
			}
			.layui-table-header th .layui-table-cell {
				height: 28px !important;
				line-height: 28px !important;
			}
		</style>

		<script src="../component/layui/layui.js"></script>

		<script type="text/html" id="task-bar">
			<button class="pear-btn pear-btn-primary pear-btn-sm" lay-event="edit" title="配置{{d.name}}节点">编辑</button>
		</script>

		<script>

			let processDefinitionId = layui.url().search.processDefinitionId;
			console.info(layui.url());

			//通用设置表单
			layui.use(['form','jquery'], function(){
				let form = layui.form;
				let $ = layui.jquery;

				//数据回显
				$.ajax({
					url:"/ProcessDefinitionController/process-definitions/getProcessConfig/"+processDefinitionId,
					type:"GET",
					contentType:"application/json",
					success:function(data){
					    console.info(data);
						data.defaultProcess==true ? data.defaultProcess="true" : data.defaultProcess="false";
						data.callable==true ? data.callable="true" : data.callable="false";
						form.val("processConfigForm",data);
					}
				});
				//监听流程配置表单提交
				form.on('submit(processConfigSubmit)', function(data){
					let formData = JSON.stringify(data.field);
                    //layer.msg(formData);
					let loading = layer.load();
                    $.ajax({
                        url:"/ProcessDefinitionController/process-definitions/saveProcessConfig",
                        type:"POST",
                        contentType:"application/json",
                        dataType:'json',
                        data: formData,
                        success:function(data){
							console.info(data);
							layer.close(loading);
							layer.msg('保存成功',{icon:1,time:1000});
                        },
						error:function(XMLHttpRequest){
							layer.close(loading);
							layer.msg("保存失败",{icon:2,time:1000});
						}
                    });
					return false;
				});
				//监听任务配置表单提交
				form.on('submit(taskConfigSubmit)', function(data){

					return false;
				});

			});

			layui.use(['table','jquery','element'], function(){

				let table = layui.table;
				let $ = layui.jquery;

				$("#taskFrom").hide();

				let cols = [
					[
						{title: '环节名称', field: 'name', align:'left'},
						{title: '环节编号', field: 'id', align:'left'},
						{title: '操作', toolbar: '#task-bar', align:'center',width:80}
					]
				];

				table.render({
					elem: '#task-table',
					url: "/WorkflowController/workflows/"+processDefinitionId,
					cols: cols ,
					skin: 'line',
					page: false,
					parseData: function(res){
						return {"code": 0,"msg": "","count": 0,"data": res};
					}
				});

				window.edit = function(obj){
					let processDefinitionId = obj.data['id'];
					layer.msg(processDefinitionId);
					$("#taskList").hide();
					$("#taskFrom").show();
				}

				window.cancel = function(obj){
					let processDefinitionId = obj.data['id'];
					layer.msg(processDefinitionId);
					$("#taskList").show();
					$("#taskFrom").hide();
				}

				//任务节点列表绑定编辑事件
				table.on('tool(task-table)', function(obj){
					if(obj.event === 'edit'){
						window.edit(obj);
					}
				});

			});


		</script>

	</head>

	<body class="pear-container">

		<!--通用配置-->
		<div class="layui-card">
			<div class="layui-card-header" style="font-weight: bold">通用设置</div>
			<div class="layui-card-body" style="margin-left:10px;">
			<!---------------通用设置项------------->
				<form class="layui-form" action="" lay-filter="processConfigForm" method="post">
					<input name="processDefinitionId" type="hidden">
					<div class="layui-row">
						<div class="layui-col-md11">
							<div class="layui-form-item">
								<label class="layui-form-label">流程名称</label>
								<div class="layui-input-block">
									<input type="text" class="layui-input" name="processDefinitionName" style="border: none;" disabled>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-row">
						<div class="layui-col-md11">
							<div class="layui-form-item">
								<label class="layui-form-label layui-required">业务类型</label>
								<div class="layui-input-block">
									<select name="businessType" lay-verify="required">
										<option value=""></option>
										<option value="CONTRACT">合同起草</option>
										<option value="CONTRACT_SIGN">合同签订</option>
										<option value="CONTRACT_CANCEL">合同解除</option>
										<option value="DISPUTE">案件起草</option>
										<option value="LAS_CENTER">法务中心</option>
									</select>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-row">
						<div class="layui-col-md11">
							<div class="layui-form-item">
								<label class="layui-form-label layui-required">单位</label>
								<div class="layui-input-block">
									<input type="text" name="unitId"  lay-verify="required" placeholder="请选择单位" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
					</div>
					<div class="layui-row">
						<div class="layui-col-md11 layui-col-md11 layui-col-sm12 layui-col-xs12">
							<div class="layui-form-item">
								<label class="layui-form-label">部门</label>
								<div class="layui-input-block">
									<input type="text" name="departmentId" placeholder="请选择部门" autocomplete="off" class="layui-input">
								</div>
							</div>
						</div>
						<i class="layui-icon layui-icon-close" style="position:relative;line-height:44px;margin-left:-20px;cursor:pointer;" onclick="alert('点我干嘛')"></i>
					</div>
					<div class="layui-row">
						<div class="layui-col-md2">
							<div class="layui-form-item">
								<label class="layui-form-label">默认流程</label>
								<div class="layui-input-block">
									<input type="radio" name="defaultProcess" value="true" title="是">
									<input type="radio" name="defaultProcess" value="false" title="否">
								</div>
							</div>
						</div>
						<div class="layui-col-md2">
							<div class="layui-form-item">
								<label class="layui-form-label">是否子流程</label>
								<div class="layui-input-block">
									<input type="radio" name="callable" value="true" title="是">
									<input type="radio" name="callable" value="false" title="否" checked>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-row">
						<div class="layui-col-md11">
							<div class="layui-form-item">
								<label class="layui-form-label">描述信息</label>
								<div class="layui-input-block">
									<textarea name="description" placeholder="请输入描述信息" class="layui-textarea" style="margin-bottom:10px;min-height:50px!important;"></textarea>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-input-block">
							<button class="layui-btn layui-btn-sm" lay-submit lay-filter="processConfigSubmit" style="padding: 0 20px;">保 存</button>
						</div>
					</div>
				</form>
			</div>
		</div>


		<!--节点设置-->
		<div class="layui-card">
			<div class="layui-card-header" style="font-weight: bold">环节设置</div>
			<div class="layui-card-body">

				<!---------------任务节点列表------------->
				<div class="layui-row" id="taskList">
					<div class="layui-col-md11" style="margin-left:10px;">
						<table id="task-table" lay-filter="task-table"></table>
					</div>
				</div>

				<!---------------任务节点配置------------->
				<form class="layui-form" action="" id="taskFrom">
					<div class="layui-tab layui-tab-brief">
						<ul class="layui-tab-title">
							<li class="layui-this">基本设置</li>
							<li>审批设置</li>
						</ul>
						<div class="layui-tab-content">
							<!--基本设置-->
							<div class="layui-tab-item layui-show">
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">会签</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="无" checked>
												<input type="radio" name="sex" value="NO" title="并行会签">
												<input type="radio" name="sex" value="NO" title="串行会签">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">处理方式</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="不指定" checked>
												<input type="radio" name="sex" value="NO" title="默认一人">
												<input type="radio" name="sex" value="NO" title="默认多人">
												<input type="radio" name="sex" value="NO" title="固定一人">
												<input type="radio" name="sex" value="NO" title="固定多人">
												<input type="radio" name="sex" value="NO" title="默认部门">
												<input type="radio" name="sex" value="NO" title="固定部门">
												<input type="radio" name="sex" value="NO" title="从表单获取">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">候选范围</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="人员" checked>
												<input type="radio" name="sex" value="NO" title="角色">
												<input type="radio" name="sex" value="NO" title="机构">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label layui-required">候选角色</label>
											<div class="layui-input-block">
												<input type="text" name="title"  lay-verify="required" placeholder="请选择角色" autocomplete="off" class="layui-input">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">候选人员</label>
											<div class="layui-input-block">
												<input type="text" name="title"  lay-verify="required" placeholder="请选择人员" autocomplete="off" class="layui-input">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">候选机构</label>
											<div class="layui-input-block">
												<input type="text" name="title"  lay-verify="required" placeholder="请选择机构" autocomplete="off" class="layui-input">
											</div>
										</div>
									</div>
								</div>

								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">部门职位</label>
											<div class="layui-input-block">
												<input type="text" name="title"  lay-verify="required" placeholder="请部门职位" autocomplete="off" class="layui-input">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label">表单字段</label>
											<div class="layui-input-block">
												<input type="text" name="title"  lay-verify="required" autocomplete="off" class="layui-input">
											</div>
										</div>
									</div>
								</div>
							</div>
							<!--审批设置-->
							<div class="layui-tab-item">
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label" style="width: 120px !important;">允许编辑表单</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="是" checked>
												<input type="radio" name="sex" value="NO" title="否">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label" style="width: 120px !important;">允许编辑正文</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="是" checked>
												<input type="radio" name="sex" value="NO" title="否">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label" style="width: 120px !important;">审批意见必填</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="是" checked>
												<input type="radio" name="sex" value="NO" title="否">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label" style="width: 120px !important;">显示审批记录</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="是" checked>
												<input type="radio" name="sex" value="NO" title="否">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label" style="width: 120px !important;">审批允许驳回</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="是" checked>
												<input type="radio" name="sex" value="NO" title="否">
											</div>
										</div>
									</div>
								</div>
								<div class="layui-row">
									<div class="layui-col-md11">
										<div class="layui-form-item">
											<label class="layui-form-label" style="width: 120px !important;">审批允许抄送</label>
											<div class="layui-input-block">
												<input type="radio" name="sex" value="YES" title="是" checked>
												<input type="radio" name="sex" value="NO" title="否">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="layui-form-item">
						<div class="layui-input-block">
							<button class="layui-btn layui-btn-sm" lay-submit lay-filter="taskConfigSubmit" style="padding: 0 20px;">保 存</button>
							<button class="layui-btn layui-btn-sm" style="padding: 0 20px;" onclick="return false;">取 消</button>
						</div>
					</div>
				</form>

			</div>
		</div>



	</body>
</html>
